// Миксин для фоновых изображений с поддержкой AVIF и WebP
@mixin background-image($src, $fallback: $src) {
  $base-name: str-slice($src, 1, str-index($src, '.') - 1);
  $avif-path: '/images/#{$base-name}.avif';
  $webp-path: '/images/#{$base-name}.webp';
  $fallback-path: '/images/#{$fallback}';

  // Fallback для старых браузеров
  background-image: url($fallback-path);

  // WebP для поддерживающих браузеров
  @supports (background-image: url('image.webp')) {
    background-image: url($webp-path);
  }

  // AVIF для самых современных браузеров
  @supports (background-image: url('image.avif')) {
    background-image: url($avif-path);
  }
}

// Миксин для отзывчивых фоновых изображений
@mixin responsive-background($mobile, $tablet: null, $desktop: null) {
  @include background-image($mobile);

  @if $tablet {
    @media (min-width: 768px) {
      @include background-image($tablet);
    }
  }

  @if $desktop {
    @media (min-width: 1024px) {
      @include background-image($desktop);
    }
  }
}

// Миксин для CSS переменных (используется с Pug миксином backgroundImage)
@mixin bg-with-vars() {
  // Fallback
  background-image: var(--bg-fallback);

  // WebP support
  @supports (background-image: url('image.webp')) {
    background-image: var(--bg-webp);
  }

  // AVIF support
  @supports (background-image: url('image.avif')) {
    background-image: var(--bg-avif);
  }
}

// Миксин для lazy loading фоновых изображений
@mixin lazy-background($src) {
  $base-name: str-slice($src, 1, str-index($src, '.') - 1);

  // Начальное состояние (размытый placeholder)
  background-color: #f0f0f0;
  background-image: linear-gradient(
    45deg,
    transparent 25%,
    rgba(255, 255, 255, 0.1) 25%,
    rgba(255, 255, 255, 0.1) 50%,
    transparent 50%,
    transparent 75%,
    rgba(255, 255, 255, 0.1) 75%
  );
  background-size: 20px 20px;
  animation: loading-shimmer 1.5s infinite linear;
  transition: all 0.3s ease;

  // Когда изображение загружено
  &.loaded {
    animation: none;
    @include background-image($src);
  }
}

@keyframes loading-shimmer {
  0% {
    background-position: -20px 0;
  }
  100% {
    background-position: 20px 0;
  }
}

// Утилиты для изображений
@mixin image-cover() {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

@mixin image-contain() {
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
}

// Миксин для оптимизации изображений в блоках
@mixin optimized-image() {
  img {
    max-width: 100%;
    height: auto;

    // Улучшение производительности
    content-visibility: auto;
    contain-intrinsic-size: 300px 200px;

    // Smooth loading
    &[loading="lazy"] {
      opacity: 0;
      transition: opacity 0.3s ease;

      &.loaded {
        opacity: 1;
      }
    }
  }

  picture {
    display: block;

    img {
      width: 100%;
      height: auto;
    }
  }
}
